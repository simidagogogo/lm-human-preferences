

正则表达式



下面详细解释一下这个正则表达式：

```python
r"""'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+"""
```

这个表达式用于 GPT-2 的分词（tokenization），其作用是匹配英语文本的各种可能的token（如缩写、人名、数字、标点、空格等）。 我们逐一拆解：

------

### 1. `\'s`

匹配 `'s`，如 `it's` 中的 `'s`。

### 2. `\'t`

匹配 `'t`，如 `don't` 中的 `'t`。

### 3. `\'re`

匹配 `'re`，如 `you're` 中的 `'re`。

### 4. `\'ve`

匹配 `'ve`，如 `they've` 中的 `'ve`。

### 5. `\'m`

匹配 `'m`，如 `I'm` 中的 `'m`。

### 6. `\'ll`

匹配 `'ll`，如 `she'll` 中的 `'ll`。

### 7. `\'d`

匹配 `'d`，如 `he'd` 中的 `'d`。

这些前面都是为英语常用缩写结尾部分设定的单独规则。

------

### 8. ` ?\p{L}+`

- `?`：可选的一个空格
- `\p{L}`：任何一种 Unicode 字母（L=Letter）
- `+`：出现一次及以上
  举例：` hello`、`W`、` é` 等（前面可以有空格，主要用于分隔单词）

------

### 9. ` ?\p{N}+`

- `?`：可选的一个空格
- `\p{N}`：任何一种 Unicode 数字（N=Number）
- `+`：一次及以上
  举例：` 123`、` ２０２３`、`1` 等（同理，前面可有空格）

------

### 10. ` ?[^\s\p{L}\p{N}]+`

- `?`：可选的一个空格
- `[^\s\p{L}\p{N}]`：不是空白、不是字母、不是数字的字符（即标点符号、特殊字符等）
- `+`：一次及以上
  举例：` !`, ` ?`, ` .`, ` @#$`, ` %` 等（前面可有空格）

------

### 11. `\s+(?!\S)`

- `\s+`：一个或多个空白符（空格、tab、换行等）
- `(?!\S)`：负向前瞻，确保**后面不是非空白字符**
  该部分用来匹配行尾的空白（例如句尾一串空格），而不是被 token 后跟着具体文本的空格。

------

### 12. `\s+`

这个也是匹配一个或多个空白符，为了保证所有空白都能被匹配。

------

### 组合说明

- `|` 表示“或”，各部分依次尝试匹配原始字符串。
- 这样可以最大化分割出 BPE 算法所需的token，“缩写”、“单词”、“数字”、“标点”、“空白”等均能拆分出来。

------

## 总结（简明）

这个正则表达式是 GPT-2 分词算法的核心之一，它支持：

- 英语缩写后缀 ('s, 're, 等)
- 单词、数字（支持前置空格）
- 标点、特殊字符
- 空白字符、断行等特殊情况

以此保证分词的准确性，利于 BPE 合并后生成 subword token。

如有具体例子或想要试验代码可以补充说明！